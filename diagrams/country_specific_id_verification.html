<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country-Specific ID Verification Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            mermaid.initialize({
                startOnLoad: true,
                theme: 'default',
                flowchart: { useMaxWidth: false }
            });
        });
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .diagram-container {
            margin-top: 30px;
        }
        .description {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Country-Specific ID Verification Diagram</h1>
        
        <div class="diagram-container">
            <pre class="mermaid">
                %%{init: {'theme': 'neutral', 'themeVariables': { 'primaryColor': '#f0f8ff', 'edgeLabelBackground':'#ffffff', 'tertiaryColor': '#fff0f0'}}}%%
                flowchart TB
                    Start([Start ID Verification]) --> UploadID[Upload ID Card]
                    UploadID --> ProcessImage[Process Image with OCR]
                    
                    ProcessImage --> DetectCountry{Detect Country}
                    
                    DetectCountry -->|Bosnian Keywords| ProcessBA[Process Bosnian ID]
                    
                    ProcessBA --> ExtractBAID[Extract Alphanumeric ID<br>7-12 characters]
                    ProcessBA --> ExtractBAName[Extract Name<br>Exclude Label Text]
                    
                    ExtractBAID --> ValidateBAFormat{Valid BA Format?}
                    ValidateBAFormat -->|Yes| CheckDuplicate{ID Already<br>Registered?}
                    ValidateBAFormat -->|No| ShowError[Show Error:<br>Invalid ID Format]
                    
                    CheckDuplicate -->|No| CreateAccount[Create User Account]
                    CheckDuplicate -->|Yes| ShowDuplicateError[Show Error:<br>ID Already Registered]
                    
                    CreateAccount --> GenerateAvatar[Generate Avatar<br>from Name Initials]
                    GenerateAvatar --> Complete([Complete Registration])
                    
                    ShowError --> RetryUpload[Retry Upload]
                    ShowDuplicateError --> RetryUpload
                    RetryUpload --> UploadID
                    
                    style Start fill:#66ccff,stroke:#333,stroke-width:2px
                    style Complete fill:#66ff66,stroke:#333,stroke-width:2px
                    style ProcessBA fill:#ffd700,stroke:#333,stroke-width:2px
                    style GenerateAvatar fill:#ff9999,stroke:#333,stroke-width:2px
                    style ShowError fill:#ff6666,stroke:#333,stroke-width:2px
                    style ShowDuplicateError fill:#ff6666,stroke:#333,stroke-width:2px
            </pre>
        </div>
        
        <div class="description">
            <h3>Diagram Description:</h3>
            <p>This diagram illustrates the country-specific ID verification process in the "What's It Like" application, focusing on Bosnian ID cards:</p>
            <ul>
                <li><strong>ID Upload and OCR:</strong> Users upload their ID card which is processed using OCR to extract text</li>
                <li><strong>Country Detection:</strong> The system detects the country of origin based on country-specific keywords in the OCR text</li>
                <li><strong>Bosnian ID Processing:</strong> 
                    <ul>
                        <li>Extracts alphanumeric ID numbers (7-12 characters) as per Bosnian ID standards</li>
                        <li>Extracts name information while excluding common label text</li>
                        <li>Validates the ID format according to Bosnian ID rules</li>
                    </ul>
                </li>
                <li><strong>Duplicate Prevention:</strong> Checks if the ID is already registered to prevent multiple accounts</li>
                <li><strong>Avatar Generation:</strong> Creates a user avatar using the initials extracted from the verified name</li>
                <li><strong>Error Handling:</strong> Provides clear error messages for invalid formats or duplicate IDs</li>
            </ul>
            <p>The system was streamlined to focus exclusively on Bosnian ID cards, with improved error handling and cleaner code organization. The implementation maintains backward compatibility through the processCountrySpecificId function that now forwards to processBosnianId.</p>
        </div>
    </div>
</body>
</html>
